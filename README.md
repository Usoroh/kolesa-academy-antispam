# Сервис "антиспам" на PHP

Создать сервис целью которого будет определять является ли сообщение спамом.

## Нормализация сообщения

Входяшее сообщение нужно разделить на токены и нормализовать:

1. Разделять предложения на токены по регулярному выражению `[\.\,\!\?\[\]\(\)\<\>\:\;\-\n\'\r\s\"\/\*\|]+`
2. Привести к нижнему регистру
3. Удалить стопслова (см. приложение)
4. Удалить слова состоящие из чисел
5. Удалить слова похожие на эл. почту (см. функцию filter_var($email, FILTER_VALIDATE_EMAIL))
6. Сортировать по алфавиту

## Проверки

По результату проверок нужно решить является ли сообщение спамом

### Проверка #1 (block_list)
Проверять на наличие слов из запрещенного списка (см. приложение). Если присутствует такое слово, то считать сообщение спамом.

### Проверка #2 (mixed_words)
Проверить нормализованное сообщение на наличие разных алфавитов, букв и цифр в одном слове. Проверка включается только если в нормализованном предложении >= 3 токенов. 
Если в нормализованном сообщении > 33.3% токенов попадает под условие считать сообщение спамом.

### Проверка #2 (duplicate)
Если в нормализованном предложении > 33.3% токенов такие же как в предыдущем, то считать сообщение спамом. Проверка включается только если в нормализованном предложении >= 3 токенов.

### Проверка #3 (rate)
Проверять на сколько часто приходять сообщения. Если приходит более 1 сообщения в 5 секунд, считать сообщения спамом.

Проверки нужно проводить в приведенном выше порядке. При первой положительной проверке, возвращать результат.

## Формат взаимодействия с сервисом

### Запрос

```
POST /is_spam
Content-Type: application/x-www-form-urlencoded

text=текст сообщения
```

### Ответ:

Не спам:

```
HTTP/1.1 200 OK

{
	"status": "ok",
	"spam": false,
	"normalized_text": "текст нормализованного сообщения"
}
```

Спам:

```
HTTP/1.1 200 OK

{
	"status": "ok",
	"spam": true,
	"reason": "причина почему сообщение считается спамом (block_list, duplicate итп.)",
	"normalized_text": "текст нормализованного сообщения"
}
```

Ошибка:

```
HTTP/1.1 400 OK

{
	"status": "error",
	"message": "field text required"
}
```

## Приложение

[Стопслова](./docs/stopwords.txt)

[Запрещенные слова](./docs/blocklist.txt)
